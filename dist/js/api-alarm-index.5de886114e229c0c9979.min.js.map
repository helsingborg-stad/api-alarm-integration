{"version":3,"file":"js/api-alarm-index.5de886114e229c0c9979.min.js","mappings":"mBAEO,MCAOA,EAAkBA,KAC5B,MAAMC,EAAUA,CAACC,EAAiBC,EAAeC,IAAiBF,EAC7DD,QAAQ,sBAAuBE,GAAS,IACxCF,QAAQ,qBAAsBG,GAAQ,IAE3C,MAAO,CACHC,qBAAsBA,CAACH,EAAiBI,IAA0BL,EAAQC,EAASI,EAAKC,MAAO,IAC/FC,eAAgBA,CAACN,EAAiBI,IAAiBL,EAAQC,EAASI,EAAKG,WAAYH,EAAKI,cAC1FC,iBAAkBA,CAACT,EAAiBI,IAAiBL,EAAQC,EAASI,EAAKG,WAAYH,EAAKI,gBCJpGE,SAASC,iBAAiB,mBAAoB,SAASC,GFJ1BC,KAEzB,MAAMC,EAAM,CACRC,UAAW,GACXC,QAAS,GACTC,cAAe,GACfC,QAAQ,EACRC,OAAQ,GACRC,OAAQ,GACRC,UAAW,GACXC,UAAW,GACXC,qBAAqB,EACrBC,mBAAmB,EACnBC,+BAA+B,EAC/BC,aAAc,GACdC,WAAY,GACZC,iBAAkB,MACff,GAGP,MAAO,CACHgB,OAAQA,EAAGC,OAAMC,WAAUC,eACvBF,EAAKG,MAAiDnB,EAAIK,OAAO,CAC7Dd,MAAOS,EAAIM,OAAOc,KAAK,OACxBC,KAAMC,IAEL,MAAMC,EAAOL,EAAUM,IAAIF,GAGvBtB,EAAIS,qBACJc,EAAKE,aAAaC,MAAMC,QAAQrC,IACxBM,SAASgC,iBAAiB,gBAAkBtC,EAAKuC,IAAIC,OAAS,GAGlElC,SAASmC,cAAc/B,EAAIY,eAAeoB,mBAAmB,aACzDf,EAAStB,iBAAiBK,EAAIC,UAAWX,MAIjDU,EAAIU,mBACJa,EAAKE,aAAaQ,IAAIN,QAAQrC,IACtBM,SAASgC,iBAAiB,gBAAkBtC,EAAKuC,IAAIC,OAAS,GAGlElC,SAASmC,cAAc/B,EAAIa,aAAamB,mBAAmB,aACvDf,EAASzB,eAAeQ,EAAIE,QAASZ,MAI7CU,EAAIW,+BACWY,EAAKW,gBAAgB5B,OAAO6B,OACtC7C,GAAwB,MAAfA,EAAK8C,OAEZT,QAAQrC,IACXM,SAASmC,cAAc/B,EAAIc,mBAAmBkB,mBAAmB,aAC7Df,EAAS5B,qBAAqBW,EAAIG,cAAeb,QAIlE+C,MAAOC,IACFC,QAAQC,IAAIF,GACZC,QAAQC,IAAI,qDExDxBC,CAAa1C,UAAUgB,OAAO,CAC3BC,KCLI,CACHG,MAAOuB,MAAUC,EAAaC,IACnBzB,MAAM,GAAGwB,KAAO,IAAIE,gBAAgBD,KAAW,CAClDE,MAAO,WACPC,SAAU,SACVC,eAAgB,gBACjB3B,KAAMC,IACL,GAAwB,MAApBA,EAAS2B,OACT,MAAM,IAAIC,MAAM,UAAU5B,EAAS2B,UAEvC,OAAO3B,EAAS6B,UDJzBlC,SAAUjC,IACVkC,UERyB,CAC5BM,IAAMD,IAAS,CACPE,aAAc,CACVC,MAAOH,GAAMG,OAASH,GAAME,cAAcC,OAAS,GACnDO,IAAKV,GAAMU,KAAOV,GAAME,cAAcQ,KAAO,IAEjDC,gBAAiB,CACbkB,gBAAiB7B,GAAMW,iBAAiBkB,iBAAmB,GAC3D9C,OAAQiB,GAAMW,iBAAiB5B,QAAU,QFEzD,E","sources":["webpack://@helsingborg-stad/api-alarm-integration/./source/js/api-alarm-notice.ts","webpack://@helsingborg-stad/api-alarm-integration/./source/js/template-service.ts","webpack://@helsingborg-stad/api-alarm-integration/./source/js/api-alarm-index.ts","webpack://@helsingborg-stad/api-alarm-integration/./source/js/http-service.ts","webpack://@helsingborg-stad/api-alarm-integration/./source/js/transform-service.ts"],"sourcesContent":["import { ApiResponse, DisturbanceSettings, Services } from \"./types\";\n\nexport const NoticeModule = (settings: Partial<DisturbanceSettings>) => {\n\n    const php = {\n        htmlSmall: '',\n        htmlBig: '',\n        htmlFirelevel: '',\n        inited: false,\n        apiUrl: '',\n        places: [],\n        more_info: '',\n        less_info: '',\n        output_small_active: false,\n        output_big_active: false,\n        output_firedangerlevel_active: false,\n        output_small: '',\n        output_big: '',\n        output_firelevel: '',\n        ...settings\n    };\n\n    return {\n        render: ({ http, template, transform}: Services) => \n            http.fetch<ApiResponse | ApiResponse['disturbances']>(php.apiUrl,{\n                place: php.places.join(',')\n            }).then((response) => {\n                // Upgrade response\n                const data = transform.map(response);\n\n                // Render Small\n                if (php.output_small_active) {\n                    data.disturbances.small.forEach(item => {\n                        if (document.querySelectorAll('#disturbance-' + item.ID).length > 0) {\n                            return;\n                        }\n                        document.querySelector(php.output_small)?.insertAdjacentHTML('afterbegin', \n                            template.getSmallTemplate(php.htmlSmall, item));\n                    });\n                }\n                // Render Big\n                if (php.output_big_active) {\n                    data.disturbances.big.forEach(item => {\n                        if (document.querySelectorAll('#disturbance-' + item.ID).length > 0) {\n                            return;\n                        }\n                        document.querySelector(php.output_big)?.insertAdjacentHTML('afterbegin', \n                            template.getBigTemplate(php.htmlBig, item));\n                    });\n                }\n                // Render Firedanger\n                if (php.output_firedangerlevel_active) {\n                    const strict = data.firedangerlevel.places.filter(\n                        (item) => item.level === '3');\n                        \n                    strict.forEach(item => {\n                        document.querySelector(php.output_firelevel)?.insertAdjacentHTML('afterbegin', \n                            template.getFirelevelTemplate(php.htmlFirelevel, item)); \n                    });\n        \n                }\n        }).catch((e) => {\n                console.log(e)\n                console.log('API Alarm Integration plugin: Request failed!');\n            })\n        }\n    \n    }\n\n\nexport default NoticeModule\n","import type { FiredangerPlace, TemplateOperations, WPPost } from \"./types\"\n\nexport const  TemplateService = (): TemplateOperations => {\n    const replace = (content: string, title: string, text: string) => content\n        .replace(\"{DISTURBANCE_TITLE}\", title ?? '')\n        .replace(\"{DISTURBANCE_TEXT}\", text ?? '');\n\n    return {\n        getFirelevelTemplate: (content: string, item: FiredangerPlace) => replace(content, item.place, ''),\n        getBigTemplate: (content: string, item: WPPost) => replace(content, item.post_title, item.post_content),\n        getSmallTemplate: (content: string, item: WPPost) => replace(content, item.post_title, item.post_content)\n    }\n}\n\n","\nimport NoticeModule from './api-alarm-notice';\nimport { HttpService } from './http-service';\nimport { TemplateService } from './template-service';\nimport { TransformService } from './transform-service';\n    \ndocument.addEventListener(\"DOMContentLoaded\", function(event) { \n    NoticeModule(settings).render({\n       http: HttpService(),\n       template: TemplateService(),\n       transform: TransformService()\n    });\n});","import { HttpOperations } from \"./types\";\n\nexport const HttpService = (): HttpOperations => {\n    return {\n        fetch: async <T>(url: string, params?: Record<string, any>): Promise<T> => {\n            return fetch(`${url}?${new URLSearchParams(params)}`, {\n                cache: 'no-cache',\n                redirect: 'follow',\n                referrerPolicy: 'no-referrer',\n            }).then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(`Error: ${response.status}`);\n                }\n                return response.json() as Promise<T>;\n            });\n        },\n    }\n}\n    ","import { TransformOperations } from \"./types\"\n\nexport const TransformService = (): TransformOperations => ({\n    map: (data: any) => ({\n            disturbances: {\n                small: data?.small || data?.disturbances?.small || [],\n                big: data?.big || data?.disturbances?.big || []\n            },\n            firedangerlevel: {\n                dateTimeChanged: data?.firedangerlevel?.dateTimeChanged || '',\n                places: data?.firedangerlevel?.places || []\n            }\n        })\n})"],"names":["TemplateService","replace","content","title","text","getFirelevelTemplate","item","place","getBigTemplate","post_title","post_content","getSmallTemplate","document","addEventListener","event","settings","php","htmlSmall","htmlBig","htmlFirelevel","inited","apiUrl","places","more_info","less_info","output_small_active","output_big_active","output_firedangerlevel_active","output_small","output_big","output_firelevel","render","http","template","transform","fetch","join","then","response","data","map","disturbances","small","forEach","querySelectorAll","ID","length","querySelector","insertAdjacentHTML","big","firedangerlevel","filter","level","catch","e","console","log","NoticeModule","async","url","params","URLSearchParams","cache","redirect","referrerPolicy","status","Error","json","dateTimeChanged"],"ignoreList":[],"sourceRoot":""}