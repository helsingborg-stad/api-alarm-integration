(()=>{"use strict";var __webpack_modules__={324:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _Object__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(769);const __WEBPACK_DEFAULT_EXPORT__=function(){let _templates=[];function Template(){this.getTemplates()}return Template.prototype.render=function(key,data){let template=_templates[key];return template=template.replace(/{#\s*([\w\.\[\]]+)\s*#}/g,function(e,t){return Object.byString(data,t)}),template=template.replace(/{##\s*if(.*)\s*##}([\s\S]*?){##\s*endif\s*##}/gm,function($1,$2,$3){return eval($2)?$3:""}),template},Template.prototype.getTemplates=function(){let e=document.querySelectorAll("[data-template]");for(let t=0;t<e.length;t++){let r=e[t],a=r.getAttribute("data-template"),i=r.outerHTML.replace(/data-template="([^\"]*)"/gi,"");_templates[a]=i,r.parentElement.removeChild(r)}},new Template}()},769:()=>{Object.byString=function(e,t){let r=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split(".");for(let t=0,a=r.length;t<a;++t){let a=r[t];if(!(a in e))return;e=e[a]}return e}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},Template=__webpack_require__(324);function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:t+""}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}let ApiAlarmIntegration={Helper:{}};ApiAlarmIntegration.Helper.Template=Template.A;class AlarmModule{constructor(e){_defineProperty(this,"AlarmList",void 0),_defineProperty(this,"perPage",void 0),_defineProperty(this,"requestUrl",void 0),_defineProperty(this,"Templates",void 0),this.AlarmList=e,this.perPage=e.getAttribute("data-alarms-per-page"),this.requestUrl=e.getAttribute("data-alarm-api")+"wp/v2/alarm",this.Templates={loader:ApiAlarmIntegration.Helper?.Template?.render("api-alarm-integration-loader"),loadMore:ApiAlarmIntegration.Helper?.Template?.render("api-alarm-integration-load-more"),error:ApiAlarmIntegration.Helper?.Template?.render("api-alarm-integration-error"),noResults:ApiAlarmIntegration.Helper?.Template?.render("api-alarm-integration-no-results")},this.loadAlarms(),this.searchListener()}loadAlarms(){this.AlarmList.querySelector("[data-api-alarms-container").removeAttribute("is-loaded"),this.AlarmList.insertAdjacentHTML("beforeend",this.Templates.loader);let e=this.serialize(Object.assign({per_page:this.perPage,page:parseInt(this.getCurrentPage())+1},this.getFilters()));(async function(e=""){const t=await fetch(e,{cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow",referrerPolicy:"no-referrer"});return 200===t.status&&t.json()})(`${this.requestUrl}?${e}`).then(e=>{e||this.requestFailed(),e&&(e.length<=0&&(this.showNoResults(),this.noMoreLoadMore()),e.length>0&&(e.forEach(e=>{this.addAlarmToList(e)}),this.AlarmList.querySelector("#mod-alarm-no-result")&&this.AlarmList.querySelector("#mod-alarm-no-result").remove(),this.addAccordionListener()),e.length>=this.perPage&&(this.AlarmList.querySelector("[data-api-alarms-load-more]")||(this.AlarmList.insertAdjacentHTML("beforeend",this.Templates.loadMore),this.AlarmList.querySelector("[data-api-alarms-load-more]").addEventListener("click",()=>{this.AlarmList.setAttribute("data-alarms-current-page",parseInt(this.getCurrentPage())+1),this.loadAlarms()}))),e.length>0&&e.length<this.perPage&&this.noMoreLoadMore(),this.AlarmList.querySelector("[data-api-alarms-container]").setAttribute("is-loaded",""),this.AlarmList.querySelector("[data-api-alarms-loader]").remove())}).catch(e=>{this.requestFailed()})}getFilters(){let e={search:this.getInputValue(this.AlarmList.querySelector("#input_data-alarm-filter-text")),place:this.getInputValue(this.AlarmList.querySelector('[data-alarm-filter="place"]')),date_from:this.getInputValue(this.AlarmList.querySelector("#data-alarm-filter-date-from")?.querySelector("input")),date_to:this.getInputValue(this.AlarmList.querySelector("#data-alarm-filter-date-to")?.querySelector("input"))};"string"==typeof e.date_from&&e.date_from.includes("/")?e.date_from=e.date_from.split("/").reverse().join("-"):delete e.date_from,"string"==typeof e.date_to&&e.date_to.includes("/")?e.date_to=e.date_to.split("/").reverse().join("-"):delete e.date_to;for(let t in e)("string"==typeof e[t]&&""===e[t].trim()||null===e[t]||void 0===e[t])&&delete e[t];return e}getInputValue(e){return null!==e?e.value:""}addAlarmToList(e){e.date=e.date.replace("T"," ").substring(0,e.date.length-3);let t=ApiAlarmIntegration.Helper.Template.render("api-alarm-integration-row",e);this.AlarmList.querySelector("[data-api-alarms-container]").insertAdjacentHTML("beforeend",t)}loadMoreListener(){this.AlarmList.querySelector("[data-api-alarms-load-more]")||(this.AlarmList.insertAdjacentHTML("beforeend",this.Templates.loadMore),this.AlarmList.querySelector("[data-api-alarms-load-more]").addEventListener("click",()=>{this.AlarmList.setAttribute("data-alarms-current-page",parseInt(this.getCurrentPage())+1),this.loadAlarms()}))}searchListener(){this.AlarmList.querySelector("[data-alarm-filter-search]").addEventListener("click",()=>{this.search()}),this.AlarmList.querySelector("#input_data-alarm-filter-text").onkeydown=e=>{13==e.keyCode&&this.search()}}search(){this.AlarmList.setAttribute("data-alarms-current-page",0),this.AlarmList.querySelector("[data-api-alarms-container]").innerHTML="",this.loadAlarms()}addAccordionListener(){this.AlarmList.querySelectorAll("[data-api-alarms-row]").forEach(e=>{e.hasAttribute("has-accordion-listener")||(e.setAttribute("has-accordion-listener",""),e.addEventListener("click",e=>{e.target.closest("[data-api-alarms-row]").toggleAttribute("is-expanded")}))})}noMoreLoadMore(){this.AlarmList.querySelector("[data-api-alarms-load-more]")&&this.AlarmList.querySelector("[data-api-alarms-load-more]").remove()}getCurrentPage(){return this.AlarmList.getAttribute("data-alarms-current-page")}showNoResults(){this.AlarmList.querySelector("#mod-alarm-no-result")||this.AlarmList.querySelector(".c-card__body").insertAdjacentHTML("beforeend",this.Templates.noResults)}serialize(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}requestFailed(){this.AlarmList.querySelector("[data-api-alarms-container").setAttribute("is-loaded",""),this.AlarmList.querySelector("[data-api-alarms-loader]").remove(),this.AlarmList.querySelector(".c-card__body").innerHTML="",this.AlarmList.querySelector(".c-card__body").insertAdjacentHTML("beforeend",this.Templates.error)}}const api_alarm_module=AlarmModule;document.querySelectorAll("[data-api-alarms]").forEach(e=>{new api_alarm_module(e)})})();
//# sourceMappingURL=api-alarm-integration.1db6c40f17b6dd00b483.min.js.map